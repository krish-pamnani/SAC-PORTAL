# SAC Portal - Render Deployment Guide

This guide will help you deploy the SAC Portal to Render.

## Prerequisites

1. **Render Account**: Sign up at https://render.com
2. **Supabase Database**: Your Supabase project should be set up and running
3. **GitHub Repository**: The code is already pushed to https://github.com/krish-pamnani/SAC-PORTAL

## Deployment Steps

### Option 1: Using Render Blueprint (Recommended)

1. **Go to Render Dashboard**
   - Visit https://dashboard.render.com/

2. **Create New Blueprint**
   - Click "New" → "Blueprint"
   - Connect your GitHub account if not already connected
   - Select the repository: `krish-pamnani/SAC-PORTAL`
   - Render will automatically detect the `render.yaml` file

3. **Configure Environment Variables**
   
   You'll need to set the following environment variables:

   **For Backend (sac-portal-backend):**
   - `SUPABASE_URL`: Your Supabase project URL (e.g., https://xxxxx.supabase.co)
   - `SUPABASE_ANON_KEY`: Your Supabase anon/public key
   - `SUPABASE_SERVICE_KEY`: Your Supabase service role key
   - `EMAIL_USER`: Your Gmail address for sending emails
   - `EMAIL_PASSWORD`: Your Gmail app password (not regular password)
   - `EMAIL_FROM`: Display name and email (e.g., "SAC Treasury <your-email@gmail.com>")
   - `FRONTEND_URL`: Will be your frontend URL after deployment (update after frontend is deployed)

   **For Frontend (sac-portal-frontend):**
   - `REACT_APP_API_URL`: Will be your backend URL after deployment (update after backend is deployed)

4. **Deploy**
   - Click "Apply" to deploy both services
   - Wait for the build to complete (5-10 minutes)

5. **Update Environment Variables**
   - Once both services are deployed, note their URLs:
     - Backend URL: `https://sac-portal-backend.onrender.com` (example)
     - Frontend URL: `https://sac-portal-frontend.onrender.com` (example)
   
   - Update the environment variables:
     - In **backend**: Set `FRONTEND_URL` to your frontend URL
     - In **frontend**: Set `REACT_APP_API_URL` to your backend URL
   
   - Trigger a manual redeploy for both services

### Option 2: Manual Deployment

#### Deploy Backend

1. **Create Web Service**
   - Go to Render Dashboard → New → Web Service
   - Connect your GitHub repository
   - Configure:
     - **Name**: sac-portal-backend
     - **Root Directory**: (leave empty)
     - **Environment**: Node
     - **Build Command**: `cd backend && npm install`
     - **Start Command**: `cd backend && npm start`
     - **Plan**: Free

2. **Add Environment Variables** (same as above)

#### Deploy Frontend

1. **Create Static Site**
   - Go to Render Dashboard → New → Static Site
   - Connect your GitHub repository
   - Configure:
     - **Name**: sac-portal-frontend
     - **Root Directory**: (leave empty)
     - **Build Command**: `cd frontend && npm install && npm run build`
     - **Publish Directory**: `frontend/build`

2. **Add Environment Variables**
   - `REACT_APP_API_URL`: Your backend URL

## Post-Deployment Configuration

### 1. Set up Supabase Database

Run the SQL scripts from the `database/` folder in your Supabase SQL editor:
1. `01_create_tables.sql`
2. `02_row_level_security.sql`
3. `03_helper_functions.sql`

### 2. Initialize Backend Data

You can use the setup script to load initial data:
- SSH into your backend service or run locally pointing to production
- Run: `node setup.js`

### 3. Gmail App Password

To send emails, you need a Gmail App Password:
1. Go to your Google Account → Security
2. Enable 2-Step Verification
3. Go to App Passwords
4. Generate a new app password for "Mail"
5. Use this password in `EMAIL_PASSWORD` environment variable

### 4. CORS Configuration

The backend is already configured to accept requests from any origin in production. If you want to restrict it:
- Edit `backend/server.js`
- Update the CORS configuration with your frontend URL

## Important Notes

⚠️ **Free Tier Limitations:**
- Services may spin down after 15 minutes of inactivity
- First request after spin-down will be slow (cold start)
- Consider upgrading to paid plan for production use

⚠️ **Environment Variables:**
- Never commit `.env` files to GitHub
- Use Render's environment variable dashboard to set sensitive data
- `JWT_SECRET` and `BANK_ENCRYPTION_KEY` are auto-generated by Render

⚠️ **Database:**
- Supabase free tier has usage limits
- Monitor your database usage in Supabase dashboard

## Troubleshooting

### Build Fails
- Check build logs in Render dashboard
- Ensure all dependencies are in `package.json`
- Verify Node version compatibility

### Backend Not Connecting to Database
- Verify Supabase credentials are correct
- Check if Supabase project is active
- Review backend logs in Render

### Frontend Can't Reach Backend
- Ensure `REACT_APP_API_URL` is set correctly
- Check backend service is running
- Verify CORS configuration

### Email Not Sending
- Verify Gmail app password is correct
- Check EMAIL_USER and EMAIL_PASSWORD are set
- Review backend logs for email errors

## Monitoring

- **Logs**: Check logs in Render dashboard for each service
- **Metrics**: Monitor service metrics (CPU, memory, requests)
- **Uptime**: Set up UptimeRobot or similar for monitoring

## Support

For issues:
1. Check Render documentation: https://render.com/docs
2. Review application logs
3. Check GitHub issues in the repository

---

**Deployment Date**: February 2026  
**Repository**: https://github.com/krish-pamnani/SAC-PORTAL
